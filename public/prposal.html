<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>ææ¡ˆè¯¦æƒ…</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{background:#0f0f23;color:#fff;font-family:Arial;padding:16px}
    .card{background:#11131f;padding:16px;border-radius:8px;border:1px solid rgba(255,255,255,0.06)}
    a{color:#00ff88}
  </style>
</head>
<body>

<a href="/">â† è¿”å›é¦–é¡µ</a>
<h1>ğŸ“„ ææ¡ˆè¯¦æƒ…</h1>

<div id="content">åŠ è½½ä¸­...</div>

<script>
async function load() {
  const url = new URL(window.location.href);
  // å…¼å®¹ /proposal?id=xxx æˆ– /proposal.html?id=xxx
  const id = url.searchParams.get("id");
  if (!id) {
    document.getElementById("content").innerHTML = "<p>æ— æ•ˆçš„ææ¡ˆ ID</p>";
    return;
  }

  try {
    const res = await fetch("/api/get?id=" + encodeURIComponent(id));
    const j = await res.json();
    if (!j.ok) {
      document.getElementById("content").innerHTML = "<p>æœªæ‰¾åˆ°ææ¡ˆ</p>";
      return;
    }
    const p = j.proposal;
    document.getElementById("content").innerHTML = `
      <div class="card">
        <h2>${escapeHtml(p.title)}</h2>
        <p>${escapeHtml(p.description).replace(/\n/g,"<br>")}</p>
        <p><strong>é¢„ç®—ï¼š</strong>${p.budget}</p>
        <p><strong>åˆ›å»ºæ—¶é—´ï¼š</strong>${new Date(p.createdAt).toLocaleString()}</p>
        <div style="margin-top:12px;">
          <button id="voteBtn">ğŸ‘ æŠ•ç¥¨</button>
        </div>
      </div>
    `;
    document.getElementById("voteBtn").addEventListener("click", async ()=> {
      const r = await fetch("/api/voteProposal", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ id: p.id, vote: 1 })
      });
      const rr = await r.json();
      if (r.ok) alert("æŠ•ç¥¨æˆåŠŸ"); else alert("æŠ•ç¥¨å¤±è´¥ï¼š" + (rr.error||""));
    });
  } catch (err) {
    document.getElementById("content").innerHTML = "<p>è¯·æ±‚å‡ºé”™ï¼š" + err.message + "</p>";
  }
}

function escapeHtml(s){ return String(s||"")
  .replace(/&/g,"&amp;")
  .replace(/</g,"&lt;")
  .replace(/>/g,"&gt;")
  .replace(/"/g,"&quot;")
  .replace(/'/g,"&#39;"); }

load();
</script>

</body>
</html>
